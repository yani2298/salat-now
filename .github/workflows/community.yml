name: ðŸŒŸ Community & Stars Automation

on:
  watch:
    types: [started]
  fork:
    types: [created]
  issues:
    types: [opened, labeled]
  pull_request:
    types: [opened, review_requested]
  schedule:
    - cron: '0 12 * * *'  # Daily at noon UTC
  workflow_dispatch:

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  # Thank users for starring (Starstruck achievement)
  thank-stargazers:
    runs-on: ubuntu-latest
    if: github.event_name == 'watch' && github.event.action == 'started'
    steps:
      - name: Thank new stargazer
        uses: actions/github-script@v7
        with:
          script: |
            const stargazer = context.payload.sender.login;
            
            // Create a discussion post thanking the user
            console.log(`â­ New star from ${stargazer}! Total stars: ${context.payload.repository.stargazers_count}`);
            
            // Create an issue to track star milestones
            if (context.payload.repository.stargazers_count % 10 === 0) {
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `ðŸŽ‰ ${context.payload.repository.stargazers_count} Stars Milestone!`,
                body: `## ðŸŒŸ We've reached ${context.payload.repository.stargazers_count} stars!

                JazakAllahu Khair to all our supporters! ðŸ¤²

                ### Latest Stargazer: @${stargazer}

                Help us reach the next milestone by:
                - ðŸ”„ Sharing the app with fellow Muslims
                - ðŸ› Reporting bugs and suggesting features  
                - ðŸŒ Contributing translations
                - ðŸ“± Using the app in your daily prayers

                **Next milestone**: ${context.payload.repository.stargazers_count + 10} stars â­`,
                labels: ['milestone', 'community', 'celebration']
              });
            }

  # Welcome new forks
  welcome-forkers:
    runs-on: ubuntu-latest
    if: github.event_name == 'fork'
    steps:
      - name: Welcome new contributor
        uses: actions/github-script@v7
        with:
          script: |
            const forker = context.payload.forkee.owner.login;
            
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ðŸš€ Welcome new contributor: @${forker}`,
              body: `## ðŸŽ‰ Welcome @${forker}!

              Thank you for forking Salat Now! ðŸ•Œ

              ### ðŸ› ï¸ Getting Started
              1. Check out our [Development Guide](README.md#development)
              2. Review our [Contributing Guidelines](CONTRIBUTING.md)
              3. Join our community discussions

              ### ðŸ’¡ Ways to Contribute
              - ðŸ› Fix bugs or improve performance
              - ðŸŒ Add translations for your language
              - âœ¨ Implement new Islamic features
              - ðŸ“± Enhance the user interface

              ### ðŸŽ¯ Achievement Goals
              Your contributions help us unlock GitHub achievements! ðŸ†

              Looking forward to your pull requests! JazakAllahu Khair! ðŸ¤²`,
              labels: ['welcome', 'contributor', 'community'],
              assignees: ['yani2298']
            });

  # Create engaging issues for community
  community-challenges:
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule'
    steps:
      - uses: actions/checkout@v4

      - name: Create weekly community challenge
        uses: actions/github-script@v7
        with:
          script: |
            const challenges = [
              {
                title: "ðŸŒ Translation Challenge: Add Arabic Support",
                body: `## ðŸŒ Weekly Community Challenge

                ### Goal: Add Arabic (RTL) Language Support

                Help make Salat Now accessible to Arabic speakers worldwide!

                ### Tasks:
                - [ ] Translate UI strings to Arabic
                - [ ] Implement RTL layout support
                - [ ] Test with Arabic prayer terms
                - [ ] Add Arabic number formatting

                **Reward**: Special mention in README + Achievement unlock! ðŸ†

                **Skills needed**: Arabic language, CSS/HTML, React
                **Difficulty**: Intermediate

                Comment below if you're interested! ðŸš€`,
                labels: ['good first issue', 'translation', 'community-challenge', 'help wanted']
              },
              {
                title: "ðŸŽ¨ UI Enhancement: Prayer Cards Redesign",
                body: `## ðŸŽ¨ Weekly Design Challenge

                ### Goal: Modernize Prayer Time Cards

                Create beautiful, modern prayer time cards for our macOS menu bar app!

                ### Tasks:
                - [ ] Design new card layouts
                - [ ] Implement dark/light mode
                - [ ] Add smooth animations
                - [ ] Optimize for menu bar size

                **Reward**: Featured in app showcase + Achievement unlock! ðŸ†

                **Skills needed**: CSS, React, Design
                **Difficulty**: Beginner-Intermediate

                Share your designs below! ðŸŽ¨`,
                labels: ['good first issue', 'design', 'community-challenge', 'enhancement']
              },
              {
                title: "ðŸ”” Feature Request: Smart Prayer Reminders",
                body: `## ðŸ”” Advanced Feature Challenge

                ### Goal: Intelligent Prayer Notification System

                Build smart reminders that adapt to user behavior!

                ### Tasks:
                - [ ] Implement adaptive timing
                - [ ] Add location-based adjustments
                - [ ] Create custom notification sounds
                - [ ] Build reminder analytics

                **Reward**: Co-authorship credit + Achievement unlock! ðŸ†

                **Skills needed**: TypeScript, Electron, Node.js
                **Difficulty**: Advanced

                Let's build something amazing! ðŸš€`,
                labels: ['feature', 'advanced', 'community-challenge', 'help wanted']
              }
            ];

            const challenge = challenges[Math.floor(Math.random() * challenges.length)];
            
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: challenge.title,
              body: challenge.body,
              labels: challenge.labels
            });

  # Social media automation
  social-promotion:
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule'
    steps:
      - name: Generate social media content
        run: |
          echo "ðŸ“± Building social media presence for Salat Now..."
          echo "ðŸŽ¯ Goal: Increase stars and community engagement"
          echo "ðŸ“Š Current metrics will be tracked here"
          
          # This could integrate with social media APIs
          # For now, we'll create tracking issues
          
      - name: Create social media tracking issue
        uses: actions/github-script@v7
        with:
          script: |
            const today = new Date().toLocaleDateString();
            
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ðŸ“± Social Media Campaign - ${today}`,
              body: `## ðŸ“± Daily Social Media Promotion

              ### ðŸŽ¯ Goals for Today
              - [ ] Share on Twitter/X about Islamic app development
              - [ ] Post in Muslim developer communities
              - [ ] Share in Islamic tech forums
              - [ ] Cross-post to relevant Reddit communities

              ### ðŸ“Š Current Stats
              - â­ Stars: ${context.payload.repository.stargazers_count}
              - ðŸ´ Forks: ${context.payload.repository.forks_count}
              - ðŸ‘€ Watchers: ${context.payload.repository.watchers_count}

              ### ðŸŽ¯ Achievement Progress
              - Pull Shark: Working on automated PRs ðŸ¦ˆ
              - Starstruck: Growing star count â­
              - Heart On Your Sleeve: Auto-reacting to issues â¤ï¸

              **Help us spread the word! Share this project with the Muslim tech community! ðŸŒ**`,
              labels: ['marketing', 'community', 'social-media', 'daily-task']
            });

  # Achievement tracking
  track-achievements:
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'schedule'
    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Update achievement progress
        run: |
          cat > .github/ACHIEVEMENT_PROGRESS.md << 'EOF'
          # ðŸ† GitHub Achievement Progress

          Last Updated: $(date)

          ## ðŸŽ¯ Target Achievements

          ### â­ Starstruck
          - **Goal**: Get stars on repositories
          - **Status**: ðŸ”„ In Progress
          - **Strategy**: Community engagement, social media promotion

          ### ðŸ¦ˆ Pull Shark
          - **Goal**: Open multiple pull requests
          - **Status**: ðŸ”„ In Progress  
          - **Strategy**: Automated PRs, community contributions

          ### âš¡ Quickdraw
          - **Goal**: Close issues/PRs quickly
          - **Status**: ðŸ”„ In Progress
          - **Strategy**: Automated issue management

          ### ðŸ‘¥ Pair Extraordinaire
          - **Goal**: Co-authored commits
          - **Status**: ðŸ”„ In Progress
          - **Strategy**: Bot co-authoring, community collaboration

          ### â¤ï¸ Heart On Your Sleeve
          - **Goal**: React to issues/PRs
          - **Status**: âœ… Active
          - **Strategy**: Automated reactions system

          ### ðŸ”ï¸ Arctic Code Vault Contributor
          - **Goal**: Contribute to archived projects
          - **Status**: ðŸ”„ Waiting for next archive

          ## ðŸ“Š Community Stats
          - Total Contributors: Growing ðŸ“ˆ
          - Active Issues: Managed daily ðŸ”„
          - Community Engagement: High âš¡

          ---
          *This file is auto-updated by GitHub Actions*
          EOF

      - name: Commit achievement tracking
        run: |
          git config --global user.name "Achievement Tracker"
          git config --global user.email "tracker@salatnow.app"
          git add .github/ACHIEVEMENT_PROGRESS.md
          git commit -m "ðŸ“Š Update achievement tracking

          Co-authored-by: Anis Mosbah <contact@salatnow.app>" || echo "No changes"
          git push || echo "Push failed" 